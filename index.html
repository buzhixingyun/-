<!DOCTYPE html>  
<html lang="zh-CN">  
<head>  
    <meta charset="UTF-8">  
    <!-- ç¦ç”¨ç¼©æ”¾ï¼Œä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">  
    <title>Merry Christmas! ğŸ„</title>  
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700&family=Ma+Shan+Zheng&display=swap" rel="stylesheet">  
  
    <style>  
        /* --- 1. æ ¸å¿ƒé…è‰²ä¸åŸºç¡€è®¾ç½® --- */  
        :root {  
            --bg-color: #FFFBF0;        
            --primary: #FF8FA3;         
            --secondary: #B5EAD7;       
            --text-color: #D4A373;      
            --accent: #FFE577;          
            --card-bg: #FFFFFF;  
            --paper-color: #FFF8E7;  
        }  
  
        * { margin: 0; padding: 0; box-sizing: border-box; }  
  
        body {  
            background-color: var(--bg-color);
            color: var(--text-color);  
            font-family: 'Nunito', 'Ma Shan Zheng', sans-serif;   
            overflow: hidden;   
            height: 100vh; height: 100dvh; width: 100vw;  
            cursor: default;   
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            transition: background-color 1.2s cubic-bezier(0.4, 0, 0.2, 1);
        }  

        /* --- Loading Screen --- */
        #loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.8s ease-out;
        }
        .loading-icon {
            font-size: 4.5rem;
            animation: bounceGift 1s infinite alternate ease-in-out;
            filter: drop-shadow(0 15px 15px rgba(255, 143, 163, 0.3));
            margin-bottom: 20px;
        }
        @keyframes bounceGift { 0% { transform: translateY(0); } 100% { transform: translateY(-15px); } }
        .loading-bar-container {
            width: 200px; height: 10px; background: #FFF0F5;
            border-radius: 20px; overflow: hidden; position: relative;
        }
        .loading-bar {
            width: 0%; height: 100%; background: var(--primary);
            border-radius: 20px; transition: width 1.5s ease;
        }
        .loading-text { margin-top: 15px; font-family: 'Ma Shan Zheng'; opacity: 0.9; }

        /* --- Background Layers --- */
        #bg-base-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; pointer-events: none;
            background: linear-gradient(-45deg, #fff5f5, #e8f5e9, #fffde7, #fff0f5);
            background-size: 400% 400%; animation: gradientBG 15s ease infinite;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        #theme-layer { position: fixed; inset: 0; z-index: 1; pointer-events: none; }
        #snow-container { position: fixed; inset: 0; pointer-events: none; z-index: 2; } 

        /* --- é¡¶éƒ¨è£…é¥° --- */
        .light-rope {
            position: fixed; top: -15px; left: 0; width: 100%; height: 60px;
            z-index: 100; pointer-events: none; display: flex; justify-content: space-around;
            transition: transform 0.8s;
        }
        .light-rope.hidden { transform: translateY(-100px); }
        .light-bulb {
            position: relative; width: 16px; height: 36px; border-radius: 50%; background: #fff; margin-top: 10px;
            animation: swing 3s ease-in-out infinite alternate, glow 1.5s infinite alternate;
        }
        .light-wire { position: absolute; top: -5px; left: 0; width: 100%; height: 25px; border-bottom: 2px solid #444; border-radius: 50%; z-index: 99; }
        .light-bulb:nth-child(2n) { background: #FF8FA3; animation-delay: 0.2s; }
        .light-bulb:nth-child(2n+1) { background: #B5EAD7; animation-delay: 0.5s; }
        .light-bulb:nth-child(3n) { background: #FFE577; animation-delay: 0.8s; }
        @keyframes swing { 0% { transform: rotate(-3deg); } 100% { transform: rotate(3deg); } }
        @keyframes glow { 0% { opacity: 0.7; } 100% { opacity: 1; transform: scale(1.1); } }

        /* --- Music Control --- */
        #music-control {
            position: fixed; top: 20px; right: 20px; width: 44px; height: 44px; 
            background: rgba(255, 255, 255, 0.9); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            z-index: 1000; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            font-size: 22px; transition: transform 0.2s;
        }
        #music-control.playing { animation: spin 4s linear infinite; color: var(--primary); }
        @keyframes spin { 100% { transform: rotate(360deg); } }
  
        /* --- Stages --- */  
        .overlay-stage {
            position: fixed; inset: 0; display: flex; align-items: center; justify-content: center;
            z-index: 500; opacity: 0; visibility: hidden; pointer-events: none;
            transition: opacity 0.6s ease, visibility 0.6s;
        }
        .overlay-stage.active { opacity: 1; visibility: visible; pointer-events: auto; backdrop-filter: blur(3px); }

        .dialog-box {  
            background-color: var(--paper-color); width: 88%; max-width: 480px; padding: 35px 30px; 
            border-radius: 24px; border: 3px solid var(--text-color);  
            box-shadow: 8px 8px 0px rgba(212, 163, 115, 0.4); position: relative; 
            transform: scale(0.8) translateY(30px); opacity: 0;
            transition: transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.6s ease;
        }
        .overlay-stage.active .dialog-box { transform: scale(1) translateY(0); opacity: 1; }
        .overlay-stage.exit .dialog-box { transform: scale(1.1) translateY(-10px); opacity: 0; transition: all 0.5s; }
  
        .dialog-pin { position: absolute; top: 16px; left: 50%; transform: translateX(-50%); width: 16px; height: 16px; background: var(--primary); border-radius: 50%; }  
        .dialog-content { margin-top: 20px; font-family: 'Ma Shan Zheng'; font-size: 1.3rem; line-height: 1.8; color: #5d4037; min-height: 80px; }
        .action-btn {  
            background-color: var(--primary); color: white; font-family: 'Fredoka One'; font-size: 1.1rem;
            padding: 12px 32px; border: none; border-radius: 50px; margin-top: 25px; cursor: pointer; float: right;  
            box-shadow: 0 4px 0 #d86c7f; transition: transform 0.1s;
        }  
        .action-btn:active { transform: translateY(4px); box-shadow: none; }  
        .action-btn.disabled { opacity: 0.6; pointer-events: none; filter: grayscale(1); }

        /* --- Heart Game --- */
        #game-layer { position: fixed; inset: 0; z-index: 600; pointer-events: none; }  
        .msg-box {  
            position: absolute; width: 60px; height: 60px; 
            background: rgba(255, 255, 255, 0.9); border-radius: 16px; 
            display: flex; align-items: center; justify-content: center;  
            font-size: 15px; font-weight: bold; color: #8d6e63; font-family: 'Ma Shan Zheng'; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); opacity: 0; transform: scale(0);
            transition: all 0.8s cubic-bezier(0.25, 1, 0.5, 1);
        }  
        .msg-box:nth-child(4n+1) { background: #FFD1DC; color: #fff; }  
        .msg-box:nth-child(4n+2) { background: #E2F0CB; color: #779966; }  
        .msg-box:nth-child(4n+3) { background: #FFF5BA; color: #D4A373; }  

        /* --- Welcome Card --- */
        .welcome-card {  
            background: var(--card-bg); width: 90%; max-width: 450px; padding: 40px 30px;  
            border-radius: 30px; border: 4px dashed var(--primary);  
            box-shadow: 0 20px 50px rgba(212, 163, 115, 0.2); text-align: center;  
            transform: translateY(60px) scale(0.9); opacity: 0; transition: all 0.8s;   
        }  
        .overlay-stage.active .welcome-card { transform: translateY(0) scale(1); opacity: 1; }
        .overlay-stage.exit .welcome-card { transform: scale(0.8) opacity(0); }

        /* =========================================
           FINAL SCENE: Outdoor -> Indoor Transition
           ========================================= */
        #final-scene-root {
            position: fixed; inset: 0; z-index: 10; 
            opacity: 0; pointer-events: none;
            overflow: hidden;
            transition: opacity 1s;
        }
        #final-scene-root.active { opacity: 1; pointer-events: auto; }

        /* --- 1. Outdoor House View --- */
        #outdoor-house-scene {
            position: absolute; inset: 0;
            background: linear-gradient(to bottom, #0f172a 0%, #2c3e50 100%);
            transform-origin: 50% 70%; /* Zoom into chimney */
            transition: transform 2.5s cubic-bezier(0.7, 0, 0.3, 1), opacity 2s ease-in;
            z-index: 20;
        }
        .moon { position: absolute; top: 10%; right: 10%; width: 80px; height: 80px; background: #ffd700; border-radius: 50%; box-shadow: 0 0 40px #ffd700; }
        .house-silhouette {
            position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 300px; height: 250px; background: #3e2723;
            display: flex; justify-content: center;
        }
        .house-roof {
            position: absolute; top: -100px; left: -20px;
            width: 0; height: 0;
            border-left: 170px solid transparent;
            border-right: 170px solid transparent;
            border-bottom: 100px solid #5d4037;
        }
        .chimney {
            position: absolute; top: -80px; right: 40px;
            width: 40px; height: 60px; background: #795548;
            border-top: 6px solid #3e2723;
        }
        .santa-wrapper {
            position: absolute; top: 100%; right: 45px; /* Start below chimney */
            font-size: 2rem;
            opacity: 0;
        }
        /* Santa Animation Sequence */
        .santa-animate {
            animation: climbAndFall 4s forwards;
        }
        @keyframes climbAndFall {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            40% { transform: translateY(-180px) scale(1); } /* Reach top */
            50% { transform: translateY(-180px) scale(1); } /* Pause */
            60% { transform: translateY(-190px) scale(0.8); opacity: 1; } /* Go slightly up/in */
            100% { transform: translateY(-100px) scale(0.1); opacity: 0; } /* Fall in */
        }

        /* --- 2. Indoor Room View --- */
        #indoor-room-scene {
            position: absolute; inset: 0;
            background: radial-gradient(circle at 50% 50%, #ffecd2, #fcb69f);
            z-index: 10; opacity: 0;
            transition: opacity 2s ease 1s; /* Delay fade in slightly */
            display: flex; flex-direction: row;
            perspective: 1000px; /* For 3D feel */
        }
        
        /* Room Zoning */
        .room-left {
            width: 25%; height: 100%; position: relative;
            display: flex; flex-direction: column; justify-content: flex-end; align-items: flex-start;
            padding-left: 10px;
        }
        .room-center {
            width: 40%; height: 100%; position: relative;
            display: flex; justify-content: center; align-items: flex-end;
        }
        .room-right {
            width: 35%; height: 100%; position: relative;
            display: flex; flex-direction: column; justify-content: flex-end;
        }

        /* -- Left: Fireplace & Decor -- */
        .wall-decor-wreath {
            position: absolute; top: 20%; left: 20%;
            font-size: 4rem; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.2));
        }
        .fireplace-side {
            width: 100%; height: 220px;
            background: linear-gradient(90deg, #5d4037 80%, #4e342e 100%);
            position: relative; bottom: 0;
            border-radius: 4px 4px 0 0;
            display: flex; align-items: flex-end; justify-content: center;
            box-shadow: 5px 0 15px rgba(0,0,0,0.3);
            transform: skewY(-5deg); /* Fake perspective */
            margin-bottom: 20px;
        }
        .fire-opening {
            width: 70%; height: 60%; background: #3e2723;
            border-radius: 20px 20px 0 0; position: relative; overflow: hidden;
            box-shadow: inset 0 0 20px black;
        }
        .fire-flame {
            position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
            font-size: 2rem; animation: burn 0.6s infinite alternate;
        }
        @keyframes burn { 0% { transform: translateX(-50%) scale(1); } 100% { transform: translateX(-50%) scale(1.2); opacity: 0.8; } }

        /* -- Center: Tree & Orbit -- */
        .giant-tree-container {
            position: relative; width: 100%; height: 85%;
            display: flex; justify-content: center; align-items: flex-end;
        }
        .tree-img {
            font-size: 18rem; line-height: 1; z-index: 10; /* Tree base z-index */
            filter: drop-shadow(0 10px 10px rgba(0,0,0,0.3));
            transform-origin: bottom center;
        }
        
        /* Orbit Logic */
        .orbit-path {
            position: absolute; top: 10%; left: 50%;
            width: 300px; height: 100px; /* Ellipse shape */
            transform: translateX(-50%);
            transform-style: preserve-3d;
            z-index: 15;
        }
        .balloon-orbiter {
            position: absolute; top: 0; left: 50%;
            width: 80px; height: 100px;
            margin-left: -40px; margin-top: -50px;
            animation: orbitMove 8s linear infinite;
            cursor: pointer;
        }
        /* 
           Orbit Logic:
           Translate X/Y for ellipse.
           Scale for depth.
           Z-Index flip to go behind tree tip (tree tip needs to be visually handled).
        */
        @keyframes orbitMove {
            0% { transform: translateX(150px) translateY(0) scale(1); z-index: 20; }
            25% { transform: translateX(0) translateY(20px) scale(1.2); z-index: 20; }
            49% { z-index: 20; }
            50% { transform: translateX(-150px) translateY(0) scale(1); z-index: 5; }
            75% { transform: translateX(0) translateY(-20px) scale(0.8); z-index: 5; }
            99% { z-index: 5; }
            100% { transform: translateX(150px) translateY(0) scale(1); z-index: 20; }
        }

        /* Balloon Graphics */
        .hot-air-balloon { width: 100%; height: 100%; position: relative; }
        .balloon-body {
            width: 70px; height: 85px; background: radial-gradient(circle at 30% 30%, #ff9a9e, #ff6a88);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            position: relative; margin: 0 auto;
            box-shadow: inset -5px -5px 10px rgba(0,0,0,0.1);
        }
        .balloon-basket {
            width: 24px; height: 20px; background: #8d6e63; margin: 2px auto 0;
            border-radius: 4px; position: relative;
        }
        .balloon-basket::after { content:'ğŸ'; position:absolute; top:-8px; left:4px; font-size:0.8rem; }

        /* -- Right: Bed & Dolls -- */
        .bed-container {
            position: absolute; bottom: 20px; right: 10px;
            width: 90%; height: 180px;
        }
        .bed-headboard {
            position: absolute; right: 0; bottom: 0; width: 20px; height: 100%;
            background: #5d4037; border-radius: 10px 10px 0 0;
        }
        .bed-mattress {
            position: absolute; right: 10px; bottom: 20px; width: 100%; height: 60px;
            background: #fff; border-radius: 10px 0 0 10px;
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }
        .bed-blanket {
            position: absolute; right: 10px; bottom: 20px; width: 80%; height: 55px;
            background: #ffcdd2; border-radius: 10px 0 0 10px;
        }
        .bed-pillow {
            position: absolute; right: 25px; bottom: 85px; width: 50px; height: 30px;
            background: #fff; border-radius: 5px; box-shadow: 2px 2px 5px rgba(0,0,0,0.05);
        }
        
        /* Dolls Layout - On Bed / Near Bed */
        .doll {
            position: absolute; font-size: 2.5rem; cursor: pointer;
            transition: transform 0.2s; z-index: 25;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.2));
        }
        .doll:hover { transform: scale(1.1); }
        .doll:active { transform: scale(0.9); }
        
        /* Doll Positions */
        .d-ginger { bottom: 90px; right: 40px; /* On pillow */ transform: rotate(-10deg); }
        .d-bear { bottom: 50px; right: 120px; /* On bed edge */ }
        .d-santa { bottom: 10px; right: 200px; /* On floor */ font-size: 2.8rem; }
        .d-snow { bottom: 10px; right: 140px; /* On floor */ }
        .d-deer { bottom: 85px; right: 180px; /* On blanket */ transform: rotate(5deg); }

        /* Pop Bubble */
        .pop-bubble {
            position: absolute; top: -40px; left: 50%; transform: translateX(-50%);
            background: #fff; padding: 4px 8px; border-radius: 8px; font-size: 12px;
            white-space: nowrap; opacity: 0; pointer-events: none;
            transition: opacity 0.3s; color: #555;
        }
        .pop-bubble.show { animation: popUp 2s forwards; }
        @keyframes popUp { 0% { opacity: 0; transform: translate(-50%, 5px); } 20% { opacity: 1; transform: translate(-50%, -10px); } 100% { opacity: 0; transform: translate(-50%, -30px); } }

        /* Flash */
        #flash-overlay { position: fixed; inset: 0; background: white; z-index: 9999; pointer-events: none; opacity: 0; transition: opacity 1s; }
        
        /* Secret Code Modal */
        #secret-modal { z-index: 2000; }

        /* Particles (Stars) */
        .falling-star {
            position: fixed; color: #FFD700; font-size: 1rem; pointer-events: none; z-index: 100;
            animation: starDrop 1s linear forwards;
        }
        @keyframes starDrop { 100% { transform: translateY(100px); opacity: 0; } }

    </style>  
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
</script>
</head>  
<body>  
    
    <!-- Loading -->
    <div id="loading-screen">
        <div class="loading-icon">ğŸ</div>
        <div class="loading-bar-container"><div class="loading-bar" id="loading-bar"></div></div>
        <div class="loading-text">æ­£åœ¨æ‰“åŒ…ç¾å¥½çš„å›å¿†...</div>
    </div>

    <!-- Backgrounds -->
    <div class="light-rope">
        <div class="light-wire"></div>
        <div class="light-bulb"></div><div class="light-bulb"></div><div class="light-bulb"></div>
        <div class="light-bulb"></div><div class="light-bulb"></div><div class="light-bulb"></div>
        <div class="light-bulb"></div><div class="light-bulb"></div><div class="light-bulb"></div>
    </div>
    <div id="bg-base-layer"></div>
    <div id="theme-layer"></div>
    <div id="snow-container"></div>  
    <div id="flash-overlay"></div>

    <!-- Audio -->
    <audio id="bgm" loop preload="auto"><source src="https://actions.google.com/sounds/v1/holiday/jingle_bells.ogg" type="audio/ogg"></audio>
    <div id="music-control" onclick="toggleMusic(event)">ğŸµ</div>
  
    <!-- Stages 0-3 (Intro, Memory, Game, Card) -->
    <div id="stage-0-intro" class="overlay-stage">  
        <div class="dialog-box">  
            <div class="dialog-pin"></div>  
            <h3 style="color: #D4A373; font-size: 1.5rem; font-family: 'Fredoka One'; margin-bottom: 10px;">To: æœ€å¯çˆ±çš„å°èƒ¡åŒå­¦ ğŸ“</h3>  
            <div class="dialog-content" id="intro-text"></div>  
            <button class="action-btn disabled" id="btn-intro" onclick="startMemories()">å¼€å¯å›å¿† &gt;</button>  
        </div>  
    </div>  
  
    <div id="stage-1-memory" class="overlay-stage">  
        <div class="dialog-box">  
            <div class="dialog-pin"></div>  
            <h3 id="mem-title" style="color: #D4A373; font-size: 1.4rem; font-family: 'Fredoka One';"></h3>  
            <div class="dialog-content typing-cursor" id="mem-text"></div>  
            <button class="action-btn disabled" id="btn-mem" onclick="nextMemory()">ä¸‹ä¸€æ­¥ &gt;</button>  
        </div>
    </div>  
  
    <div id="stage-2-invite" class="overlay-stage">  
        <div class="dialog-box">  
            <div class="dialog-pin"></div>  
            <h3 style="color: #D4A373; font-size: 1.5rem; font-family: 'Fredoka One';">To: å°èƒ¡åŒå­¦ ğŸ“</h3>  
            <div class="dialog-content" id="invite-text"></div>  
        </div>  
    </div>  
  
    <div id="game-layer"></div>  
  
    <div id="stage-3-card" class="overlay-stage">  
        <div class="welcome-card">  
            <div class="ribbon" style="position:absolute; top:-10px; right:-10px; width:80px; height:80px; background:var(--secondary); border-radius:50%; opacity:0.5; z-index:-1;"></div>  
            <h2 class="card-title" style="font-family:'Fredoka One'; font-size:1.8rem; margin-bottom:10px;">To: äº²çˆ±çš„ä½  âœ¨</h2>  
            <p style="font-size: 1.2rem; line-height: 1.6; margin-bottom: 20px;">é›†é½å•¦ï¼<br>æ¯ä¸€ä¸ªæ–¹å—éƒ½æ˜¯æˆ‘çš„å¿ƒæ„ã€‚<br>åœ£è¯å¿«ä¹ï¼</p>  
            <button class="action-btn" style="float:none;" onclick="revealFinal()">æ‹†å¼€ç¤¼ç‰© ğŸ</button>  
        </div>  
    </div> 
    
    <div id="secret-modal" class="overlay-stage">
        <div class="dialog-box" style="text-align: center;">
            <div class="dialog-pin"></div>
            <h3 style="color: #FF8FA3;">ğŸ‰ æ­å–œå‘ç°éšè—å½©è›‹ï¼</h3>
            <div class="dialog-content" style="text-align: center;">
                æˆ‘ä»¬çš„æš—è¯­æ˜¯ï¼š<br>
                <span style="font-size: 2rem; color: #FF8FA3; font-weight: bold; font-family: 'Fredoka One';">11050830</span>
                <br>å¿«æ¥æ‰¾æˆ‘å…‘æ¢ç¤¼ç‰©å§ ğŸ¤©
            </div>
            <button class="action-btn" style="float:none;" onclick="closeSecret()">æ”¶åˆ° ğŸ</button>
        </div>
    </div>
  
    <!-- Final Scene Root -->  
    <div id="final-scene-root">  
        
        <!-- 1. Outdoor Scene (Transition) -->
        <div id="outdoor-house-scene">
            <div class="moon"></div>
            <div class="house-silhouette">
                <div class="house-roof"></div>
                <div class="chimney"></div>
                <div class="santa-wrapper" id="santa">ğŸ…</div>
            </div>
        </div>

        <!-- 2. Indoor Scene (Destination) -->
        <div id="indoor-room-scene">
            
            <!-- LEFT: Fireplace -->
            <div class="room-left">
                <div class="wall-decor-wreath">ğŸ„</div>
                <div class="fireplace-side">
                    <div class="fire-opening">
                        <div class="fire-flame">ğŸ”¥</div>
                    </div>
                </div>
            </div>

            <!-- CENTER: Tree + Orbit -->
            <div class="room-center">
                <div class="giant-tree-container">
                    <div class="tree-img">ğŸ„</div>
                    <!-- Orbit System -->
                    <div class="orbit-path">
                        <div class="balloon-orbiter" onclick="handleBalloonClick(event)">
                            <div class="pop-bubble"></div>
                            <div class="hot-air-balloon">
                                <div class="balloon-body"></div>
                                <div class="balloon-basket"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT: Bed + Dolls -->
            <div class="room-right">
                <div class="bed-container">
                    <div class="bed-headboard"></div>
                    <div class="bed-mattress"></div>
                    <div class="bed-blanket"></div>
                    <div class="bed-pillow"></div>
                </div>
                
                <!-- Interactive Dolls -->
                <div class="doll d-ginger" onclick="interactDoll(this, 'é¥¼å¹²å¥½åƒ!')"><div class="pop-bubble"></div>ğŸª</div>
                <div class="doll d-bear" onclick="interactDoll(this, 'æŠ±æŠ±!')"><div class="pop-bubble"></div>ğŸ§¸</div>
                <div class="doll d-santa" onclick="interactDoll(this, 'ç¤¼ç‰©åœ¨è¿™!')"><div class="pop-bubble"></div>ğŸ…</div>
                <div class="doll d-snow" onclick="interactDoll(this, 'ä¸æƒ³èåŒ–~')"><div class="pop-bubble"></div>â›„</div>
                <div class="doll d-deer" onclick="interactDoll(this, 'Merry Xmas!')"><div class="pop-bubble"></div>ğŸ¦Œ</div>
            </div>
        </div>

    </div>  
  
    <script>  
        // ================= Data =================  
        const INTRO_TEXT = "è¿™æ˜¯æˆ‘ä»¬è®¤è¯†åæˆ‘é™ªä½ åº¦è¿‡çš„ç¬¬ä¸€ä¸ªåœ£è¯èŠ‚\nè°¨ä»¥æ­¤çºªå¿µæˆ‘ä»¬çš„å‹è°Š\nåœ¨è¿™ä¸ªå¯’å†·çš„å†¬å¤©ï¼Œå¸Œæœ›å¯ä»¥ä¸ºä½ å¸¦æ¥ä¸€ä¸æ¸©æš–";
        const INVITE_TEXT = "Helloï¼Œåœ£è¯å¿«ä¹ï¼\nè¿™é‡Œæœ‰ä¸€ä»½ç‰¹åˆ«çš„ç¤¼ç‰©é€ç»™ä½ ã€‚\nå‡†å¤‡å¥½äº†å—ï¼Ÿ";
        
        // Config
        const MEMORIES = [
            { t: "(1/9) ğŸŒ±", c: "è¿˜è®°å¾—æˆ‘ä»¬åˆšè®¤è¯†çš„æ—¶å€™å—ï¼Ÿ\né‚£æ—¶è™½ç„¶æœ‰äº›æ‹˜è°¨ï¼Œ\nä½†æ¯ä¸€æ¬¡å¯¹è¯éƒ½è®©æˆ‘è§‰å¾—ç‰¹åˆ«æŠ•ç¼˜ã€‚", theme: 'sakura' },
            { t: "(2/9) ğŸ“±", c: "åæ¥æˆ‘ä»¬è¶Šæ¥è¶Šç†Ÿæ‚‰ï¼Œ\nå¼€å§‹åˆ†äº«å½¼æ­¤çš„å–œæ€’å“€ä¹ï¼Œ\nå“ªæ€•æ˜¯ç”Ÿæ´»é‡Œçš„èŠéº»å°äº‹ï¼Œ\nä¹Ÿæ€»æƒ³ç¬¬ä¸€æ—¶é—´å‘Šè¯‰ä½ ã€‚", theme: 'planes' },
            { t: "(3/9) ğŸ®", c: "æœ€å¼€å¿ƒçš„å°±æ˜¯å’Œä½ ä¸€èµ·æ‰“æ¸¸æˆï¼\nä¸ç®¡æ˜¯ç‹è€…è£è€€è¿˜æ˜¯å’Œå¹³ç²¾è‹±...\næ¯ä¸€æ¬¡ç»„é˜Ÿå¼€é»‘ï¼Œ\néƒ½æ˜¯æˆ‘ä»¬ä¸“å±çš„å¿«ä¹æ—¶å…‰ï¼", theme: 'gaming' },
            { t: "(4/9) ğŸ’ª", c: "å½“ç„¶ä¹Ÿæœ‰ä¸€èµ·emoçš„æ—¶å€™ï¼Œ\näº’ç›¸äº’ç›¸æ‰“æ°”ï¼Œ\nå¥½åƒå°±åˆæœ‰äº†ç»§ç»­å‡çº§æ‰“æ€ªçš„åŠ¨åŠ›ã€‚", theme: 'warmth' },
            { t: "(5/9) ğŸ˜‚", c: "è°¢è°¢ä½ æ€»æ˜¯èƒ½æ¥ä½æˆ‘çš„å¥‡å¥‡æ€ªæ€ªï¼Œ\né‚£äº›åªæœ‰æˆ‘ä»¬æ‡‚çš„æ¢—ï¼Œ\næ¯æ¬¡æƒ³èµ·æ¥éƒ½ä¼šå¿ä¸ä½å˜´è§’ä¸Šæ‰¬ã€‚", theme: 'laugh' },
            { t: "(6/9) â„ï¸", c: "ä¸çŸ¥ä¸è§‰ï¼Œ\nåˆä¸€èµ·èµ°è¿‡äº†ä¸€ä¸ªæ˜¥å¤ç§‹å†¬ï¼Œ\nè¿æ¥äº†è¿™ä¸ªæµªæ¼«çš„åœ£è¯èŠ‚ã€‚", theme: 'winter' },
            { t: "(7/9) âœ¨", c: "åœ£è¯èŠ‚åˆ°äº†ï¼Œ\næƒ³æŠŠæ˜Ÿæ˜Ÿæ‘˜ä¸‹æ¥é€ç»™ä½ ï¼Œ\næ„¿ä½ æ¯å¤©éƒ½èƒ½é‡è§å±äºä½ çš„å°ç¡®å¹¸ã€‚", theme: 'stars' },
            { t: "(8/9) ğŸˆ", c: "è°¢è°¢ä½ å‡ºç°åœ¨æˆ‘çš„ç”Ÿå‘½é‡Œï¼Œ\næˆä¸ºæˆ‘ç‰¹åˆ«çš„æœ‹å‹ã€‚\nå¸Œæœ›æˆ‘ä»¬å¯ä»¥ç»§ç»­ä¸€èµ·å¤§ç¬‘ï¼Œä¸€èµ·å¯å¯çˆ±çˆ±ã€‚", theme: 'balloons' },
            { t: "(9/9) ğŸ„", c: "æœ€åï¼Œ\näº²çˆ±çš„å°èƒ¡åŒå­¦ï¼Œ\næ„¿ä½ æ°¸è¿œè¢«çˆ±åŒ…å›´ï¼Œä¸‡äº‹èƒœæ„ï¼\nåœ£è¯å¿«ä¹ï¼Œä¸æ­¢åœ£è¯ï¼Œæ¯å¤©éƒ½å¿«ä¹ï¼", theme: 'gold' }
        ];
        
        const BALLOON_MSGS = ["å¤©å¤©å¼€å¿ƒ", "æš´å¯Œ", "å¥½è¿è¿è¿", "å¿ƒæƒ³äº‹æˆ", "ä¸‡äº‹èƒœæ„", "å¹³å®‰å–œä¹", "æ°¸è¿œå°‘å¥³", "åƒä¸èƒ–", "å‘å¤§è´¢", "å¿«ä¹æ˜Ÿçƒ", "æ¬§æ°”æ»¡æ»¡", "å‰ç¨‹ä¼¼é”¦"];
        const HEART_MSGS = ["ğŸå¹³å®‰", "ğŸ’°æš´å¯Œ", "ğŸ€å¥½è¿", "â¤ï¸Love", "âœ¨é—ªè€€", "ğŸ„Xmas", "ğŸç¤¼ç‰©", "ğŸ’ªåŠ æ²¹", "ğŸ¬ç”œèœœ", "ğŸ±å¯çˆ±", "ğŸŒˆç¾å¥½", "ğŸš€ä¸Šå²¸", "ğŸ‰æ¬¢åº†", "â„ï¸çº¯æ´", "ğŸŒŸå¸Œæœ›", "ğŸ–ï¸è‡ªç”±", "ğŸ˜„å¼€å¿ƒ", "ğŸŸé”¦é²¤", "ğŸ æ¸©é¦¨", "ğŸ‘­å‹è°Š", "ğŸ°å¹¸ç¦", "ğŸŒ™æ™šå®‰", "ğŸ§¸é™ªä¼´", "ğŸ¶å¿«ä¹"];

        let currentMemIndex = 0;
        const bgm = document.getElementById('bgm');

        window.onload = async () => {
            await document.fonts.ready;
            setTimeout(() => document.getElementById('loading-bar').style.width = '100%', 500);
            setTimeout(() => {
                document.getElementById('loading-screen').style.opacity = '0';
                setTimeout(() => {
                     document.getElementById('loading-screen').style.display = 'none';
                     showStage('stage-0-intro');
                     typeWriter(document.getElementById('intro-text'), INTRO_TEXT, () => enableBtn('btn-intro'));
                }, 800);
            }, 1500);
            setInterval(createSnow, 200);
        };

        function showStage(id) {
            const current = document.querySelector('.overlay-stage.active');
            if(current) { current.classList.add('exit'); current.classList.remove('active'); setTimeout(()=> { current.style.display='none'; current.classList.remove('exit'); document.getElementById(id).style.display='flex'; setTimeout(()=>document.getElementById(id).classList.add('active'), 50); }, 550); }
            else { document.getElementById(id).style.display='flex'; setTimeout(()=>document.getElementById(id).classList.add('active'), 50); }
        }

        function typeWriter(el, text, cb) {
            el.innerHTML = ""; el.classList.add('typing-cursor'); let i=0;
            const t = setInterval(() => { if(i<text.length) { el.innerText += text.charAt(i); i++; } else { clearInterval(t); el.classList.remove('typing-cursor'); if(cb) cb(); } }, 50);
        }

        function toggleMusic(e) {
            e.stopPropagation();
            if (bgm.paused) { bgm.play(); document.getElementById('music-control').classList.add('playing'); }
            else { bgm.pause(); document.getElementById('music-control').classList.remove('playing'); }
        }

        function enableBtn(id) { document.getElementById(id).classList.remove('disabled'); }

        function startMemories() { showStage('stage-1-memory'); renderMemory(0); if(bgm.paused) bgm.play(); }

        function renderMemory(idx) {
            currentMemIndex = idx; const d = MEMORIES[idx];
            document.getElementById('mem-title').innerText = d.t;
            const txt = document.getElementById('mem-text'); txt.innerHTML = "";
            applyTheme(d.theme);
            typeWriter(txt, d.c, () => enableBtn('btn-mem'));
            document.getElementById('btn-mem').classList.add('disabled');
        }

        function nextMemory() {
            if(currentMemIndex < MEMORIES.length-1) renderMemory(currentMemIndex+1);
            else { applyTheme('default'); showStage('stage-2-invite'); setTimeout(()=>typeWriter(document.getElementById('invite-text'), INVITE_TEXT, ()=>setTimeout(startGame, 1000)), 500); }
        }

        function applyTheme(t) {
            const layer = document.getElementById('theme-layer'); layer.innerHTML = '';
            document.body.style.background = t==='stars'?'#0f172a':(t==='gaming'?'#1a103c':'#FFFBF0');
            // Simple particle generator based on theme (simplified for brevity)
            const chars = {sakura:'ğŸŒ¸', planes:'âœˆï¸', gaming:'ğŸ‘¾', laugh:'ğŸ˜‚', balloons:'ğŸˆ', gold:'âœ¨'};
            if(chars[t]) for(let i=0;i<15;i++) {
                const p = document.createElement('div'); p.innerText = chars[t];
                p.style.cssText = `position:absolute; left:${Math.random()*90}vw; animation: fall ${Math.random()*5+5}s linear infinite; font-size:1.5rem; opacity:0.7;`;
                layer.appendChild(p);
                const style = document.createElement('style'); style.innerText = `@keyframes fall { 0% { top: -10vh; transform:rotate(0deg); } 100% { top: 110vh; transform:rotate(360deg); } }`;
                layer.appendChild(style);
            }
        }

        function startGame() {
            document.getElementById('stage-2-invite').classList.remove('active');
            setTimeout(() => document.getElementById('stage-2-invite').style.display = 'none', 600);
            const layer = document.getElementById('game-layer'); layer.style.display = 'block';
            
            HEART_MSGS.forEach((msg, i) => {
                const box = document.createElement('div'); box.className = 'msg-box'; box.innerText = msg;
                // Heart Shape Math
                const t = (i/HEART_MSGS.length)*2*Math.PI;
                const x = 16*Math.pow(Math.sin(t),3); const y = -(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
                const scale = Math.min(window.innerWidth, window.innerHeight)/30;
                box.style.left = (window.innerWidth/2 + x*scale - 30) + 'px';
                box.style.top = (window.innerHeight/2 + y*scale - 30) + 'px';
                layer.appendChild(box);
                setTimeout(() => { box.style.opacity = 1; box.style.transform = 'scale(1)'; }, i*50);
            });
            
            setTimeout(() => {
                layer.style.transition = 'opacity 1s'; layer.style.opacity = 0;
                setTimeout(() => { layer.style.display='none'; showStage('stage-3-card'); }, 1000);
            }, HEART_MSGS.length*50 + 2000);
        }

        function revealFinal() {
            // 1. Hide Card
            document.getElementById('stage-3-card').classList.remove('active');
            document.querySelector('.light-rope').classList.add('hidden');
            
            // 2. White Flash
            const flash = document.getElementById('flash-overlay');
            flash.style.opacity = 1;

            setTimeout(() => {
                document.getElementById('stage-3-card').style.display = 'none';
                
                // 3. Setup Scenes
                const root = document.getElementById('final-scene-root');
                root.classList.add('active');
                
                // Fade out flash, revealing Outdoor scene
                flash.style.opacity = 0; 

                // 4. Trigger Santa Animation
                const santa = document.getElementById('santa');
                santa.classList.add('santa-animate');

                // 5. Camera Move (Zoom in to chimney) after Santa falls (approx 3.5s in)
                setTimeout(() => {
                    const outdoor = document.getElementById('outdoor-house-scene');
                    // Cubic-bezier acceleration zoom
                    outdoor.style.transform = 'scale(12) translateY(50px)';
                    outdoor.style.opacity = 0;
                    
                    // Show Indoor
                    const indoor = document.getElementById('indoor-room-scene');
                    indoor.style.opacity = 1;
                    
                    startBalloonEffects();
                }, 3500); 

            }, 1200);
        }

        // --- Interaction Logic ---
        function handleBalloonClick(e) {
            e.stopPropagation();
            if(e.target.closest('.balloon-basket')) {
                document.getElementById('secret-modal').style.display = 'flex';
                setTimeout(()=>document.getElementById('secret-modal').classList.add('active'),10);
            } else {
                // Play msg
                const bubble = e.currentTarget.querySelector('.pop-bubble');
                bubble.innerText = BALLOON_MSGS[Math.floor(Math.random()*BALLOON_MSGS.length)];
                bubble.classList.remove('show'); void bubble.offsetWidth; bubble.classList.add('show');
                createStars(e.clientX, e.clientY);
            }
        }

        function interactDoll(el, text) {
            el.style.transform = 'scale(1.2) translateY(-20px)';
            setTimeout(()=>el.style.transform = '', 300);
            const b = el.querySelector('.pop-bubble');
            b.innerText = text;
            b.classList.remove('show'); void b.offsetWidth; b.classList.add('show');
        }

        function createStars(x, y) {
            for(let i=0; i<5; i++) {
                const s = document.createElement('div'); s.className = 'falling-star'; s.innerText = 'âœ¨';
                s.style.left = x + (Math.random()*40-20) + 'px'; s.style.top = y + 'px';
                document.body.appendChild(s); setTimeout(()=>s.remove(), 1000);
            }
        }

        function closeSecret() {
            document.getElementById('secret-modal').classList.remove('active');
            setTimeout(()=>document.getElementById('secret-modal').style.display='none', 500);
        }

        function createSnow() {
            const c = document.getElementById('snow-container'); if(c.childElementCount>40) return;
            const s = document.createElement('div'); s.style.cssText = `position:absolute; top:-10px; background:white; border-radius:50%; width:${Math.random()*5+3}px; height:${Math.random()*5+3}px; left:${Math.random()*100}vw; opacity:${Math.random()*0.6+0.2}; animation:fall ${Math.random()*5+5}s linear infinite;`;
            c.appendChild(s); setTimeout(()=>s.remove(), 10000);
        }
        
        function startBalloonEffects() {
            // Periodic stars from balloon
            setInterval(() => {
                const b = document.querySelector('.balloon-orbiter');
                if(!b) return;
                const rect = b.getBoundingClientRect();
                if(rect.width > 0) createStars(rect.left + rect.width/2, rect.top + rect.height/2);
            }, 800);
        }
    </script>  
</body>  
</html>
